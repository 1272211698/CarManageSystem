<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <title>登录页面</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../static/layui/css/layui.css" media="all">
    <script src="../static/layui/layui.js" charset="utf-8"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body style="background: url(../static/images/userbackground.jpg);">
    <div style="width: 100%; height: 50px; background-color: #009f95; text-align: right">

        <div id="showUserName" style="height: 50px; width: auto; font-size: 30px; line-height: 50px; float: right" >用户名占位符 </div>

    </div>
</body>

<script>
    //注册layer组件
    layui.use('layer', function () {
        var layer = layui.layer;
    });
    //全局变量userid
    var userid;
    //获取用户信息同时验证登录
    getUserInfo();
    function getUserInfo() {
        var url = "http://localhost:8080/user/getUserInfo";
        $.ajax({
            type: "get", //指定提交的类型 get对应 doGet()方法，post--->doPost()犯法
            url: url,    //传输地址的URL
            data: {}, //data代表我们的数据  key -value类型的数据
            dataType:'JSON',
            async : false, //success和error代表是否返回成功，既后台给前台传输数据是否成功
            success: function (data)//success、error代表是否返回成功
            {
                if(data.code == "7777"){
                    window.location.href = 'http://localhost:8080/user/login'
                }else{
                    userid = data.data.userid;
                    var html ='当前登录用户：'+ data.data.userName + ' <button type="button" className="layui-btn layui-btn-danger" onclick="logout()">登出</button>'
                    $("#showUserName").html(html);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                layer.msg("网络错误！");
            }
        });
    }
    //登出接口
    function logout(){
        layer.confirm('确定要登出吗？', {
            btn: ['确定','取消'] //按钮
        }, function(){
            var url = "http://localhost:8080/user/logout";
            $.ajax({
                type: "get", //指定提交的类型 get对应 doGet()方法，post--->doPost()犯法
                url: url,    //传输地址的URL
                data: {}, //data代表我们的数据  key -value类型的数据
                dataType:'JSON',
                async : false, //success和error代表是否返回成功，既后台给前台传输数据是否成功
                success: function (data)//success、error代表是否返回成功
                {
                    location.reload();
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    layer.msg("网络错误！");
                }
            });
        }, function(){});

    }

</script>
</html>